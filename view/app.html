<!DOCTYPE html>
<html lang="en" xmlns:ng="http://angularjs.org" ng-app="app" ng-controller="mainCtrl">
<head>
  <title ng-bind="seoInfo.title()"></title>
  <link rel="icon" type="image/x-icon" href="/image/logo.png" />
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <base href="/">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="stylesheet" href="/style.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.47/css/bootstrap-datetimepicker.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bluebird/3.3.4/bluebird.min.js"></script>
  <script>
    'use strict';
  </script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.12.0/moment.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.47/js/bootstrap-datetimepicker.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular-route.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular-animate.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular-sanitize.js"></script>
  <script src="/js/framework/ui-bootstrap-tpls-2.5.0.min.js"></script>
  <script src="https://unpkg.com/angular-datetime-input"></script>
  <script src="/js/app.module.js"></script>
  <script src="/js/app.service.js"></script>
  <script src="/js/app.directive.js"></script>
  <script src="/js/app.validation.js"></script>
  <script src="/js/app.config.js"></script>
  <script src="/js/app.filter.js"></script>
  <script src="/js/group/controller.js"></script>
  <script src="/js/search/controller.js"></script>
  <script src="/js/user/controller.js"></script>
  <script src="/js/post/controller.js"></script>
  <script src="/js/component/sidebar/index.js"></script>
  <script src="/js/component/listFriend/index.js"></script>
  <script src="/js/component/chatBox/index.js"></script>
  <script src="/js/component/commentPostBox/index.js"></script>
  <script src="/js/component/alertMessage/index.js"></script>
  <script src="/js/component/announceHeader/index.js"></script>
  <script src="/js/component/popup/index.js"></script>
  <script src="/js/framework/ckeditor/ckeditor.js"></script>
  <script src = "/socket.io/socket.io.js"></script>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script>

  <script>
    (function(d, s, id){
      var js, fjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) {return;}
      js = d.createElement(s); js.id = id;
      js.src = "https://connect.facebook.net/en_US/sdk.js";
      fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));

    $(document).ready(function(params) {
    window.fbAsyncInit = function() {
      FB.init({
        appId      : '<%= facebookAppId %>',
        cookie     : true,
        xfbml      : true,
        version    : 'v5.0'
      });
      
      FB.AppEvents.logPageView();   

      FB.getLoginStatus(function(response) {
        // statusChangeCallback(response);
      });
      
    };
  });

  function checkLoginState() {
    FB.getLoginStatus(function(response) {
      statusChangeCallback(response);
    });
  }
    
  function statusChangeCallback(response) {
    if (response.status && response.status === 'connected') {
      document.getElementById("facebook_token").value = response.authResponse.accessToken;
      document.getElementById("login_facebook_form").submit();
    }
  } 
  </script>
</head>
<body>
  <div ng-bind="htmlSeo">
    <% if(typeof htmlSeo !== 'undefined'){ %> 
    <%- htmlSeo %> 
    <% } %>
  </div>
  <form method="POST" id="login_facebook_form" action="<%= base_url('login_facebook') %>">
    <input name="access_token" type="hidden" id="facebook_token">
  </form>
  <div class="container" ng-click="openMenuPhone = false">
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container navbar">
        <div class="navbar-header" id="navbar-header">
          <a class="navbar-brand" href="/"><img src="/image/logo.png" width="30px"></a>
          <form ng-submit="search(stringSearch)">
              <div class="input-group search-input">
                <input ng-model="stringSearch" type="text" class="form-control" placeholder="Search">
                <div class="input-group-btn">
                  <button class="btn btn-default" type="submit">
                    <i class="glyphicon glyphicon-search"></i>
                  </button>
                </div>
              </div>
            </form>
        </div>
        <div class="" id="myNavbar">
          <ul class="nav navbar-nav navbar-right" style="margin-right: 0px;">
            <li ng-if="!current_user">
              <div style="margin-bottom: 10px" scope="public_profile,email" onlogin="checkLoginState();" class="fb-login-button" data-width="" data-size="large" data-button-type="login_with" data-auto-logout-link="false" data-use-continue-as="false">Đăng nhập với Facebook</div>
            </li>
            <li class="">
              <div class="dropdown dropdown-user" ng-if="current_user">
                <button class="btn btn-primary btn-xs dropdown-toggle" type="button" data-toggle="dropdown">
                  <img class="icon-user-dropdown" src="{{current_user.avatar_path}}">&nbsp;&nbsp;
                  {{current_user.name}}
                  <span class="caret"></span>
                </button>
                <ul class="dropdown-menu">
                  <li><a href="/user/{{current_user._id}}">Quản lý tài khoản</a></li>
                  <li><a href="#">Đăng xuất</a></li>
                </ul>
              </div>
            </li>
          </ul>
          <ul class="announce-header text-rigth">
              <li id="menu-popup-close-btn"><button ng-click="menuPhoneButton()" class="btn btn-link btn-xs" style="font-size:24px"><i class="fa fa-bars"></i></button></li>
              <announce-header ng-if="current_user"></announce-header>
          </ul>
        </div>
      </div>
    </nav>
    
    <div class="container-fluid" id="main">    
      <div class="row content">
        <left-sidebar class="left-sidebar"></left-sidebar>
        <div class="col-sm-8 text-left content-center">
          <div ng-view autoscroll="true"></div>
        </div>
        <div style="padding-left: 0px; padding-right: 0px;" class="col-sm-2 sidenav text-left">
          <div style="position: relative;">
              <chat-box></chat-box>
          </div>
          <list-friend class="right-sidebar"></list-friend>
        </div>
      </div>
    </div>
    
    <footer class="container-fluid text-center">
      <p>Footer Text</p>
    </footer>
    <script>
      $(document).on("keydown", "form", function(event) { 
        return event.key != "Enter";
      });
      $(document).ready(function(){
          $(document).on('click', '.dropdown .dropdown-menu .more', function (e) {
          e.stopPropagation();
          });
      });
    </script>
  </div>

  <div ng-hide="!openMenuPhone" id="menu-popup" ng-init="tabShow = 'group'">
    <ul class="nav nav-tabs menu-popup-header">
      <li ng-class="{active: tabShow === 'group'}" ng-click="tabShow = 'group'"><a data-toggle="tab"><i class="fa fa-group"></i> Nhóm</a></li>
      <li ng-class="{active: tabShow === 'list_friend'}" ng-click="tabShow = 'list_friend'"><a data-toggle="tab"><i class="fa fa-user"></i> Bạn</a></li>
      <i ng-click="openMenuPhone = false" class="fa fa-close menu-popup-close-btn"></i>
    </ul>
  
    <div class="tab-content">
      <div ng-class="{'in active': tabShow === 'group'}" class="tab-pane fade">
        <left-sidebar></left-sidebar>
      </div>
      <div ng-class="{'in active': tabShow === 'list_friend'}" class="tab-pane fade">
        <list-friend></list-friend>
      </div>
    </div>
  </div>
</body>
</html>
